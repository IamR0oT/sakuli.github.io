
<!DOCTYPE html>
<html lang="en">

<head>
    
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-TMFSKHB');</script>
    

    <title>
        Sakuli End2End Testing and Monitoring | Writing Tests
    </title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="publisher" content="ConSol Consulting & Solutions Software GmbH">
    <meta name="copyright" content="ConSol Consulting & Solutions Software GmbH">
    <meta name="description" content="Behavior and performance validation of every application. DOM and native UI Testing features cover every scenario. Send performance data to monitoring systems.">
    <meta name="keywords" content="End2End E2E End to End Monitoring UI Testing RPA Robot Process Automation Support Maintenance Container S2I Images Enterprise Packages">
    <meta name="page-topic" content="IT, Business, Software Quality">
    <meta name="page-type" content="Software Product">
    <meta name="audience" clang="en" content="all">
    <meta name="robots" content="index, follow">

    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="content-language" content="en">

    <meta name="DC.Publisher" content="ConSol Consulting & Solutions Software GmbH">
    <meta name="DC.Rights" content="ConSol Consulting & Solutions Software GmbH">
    <meta name="DC.Description" content="Behavior and performance validation of every application. DOM and native UI Testing features cover every scenario. Send performance data to monitoring systems.">
    <meta name="DC.Language" content="en">

    <meta property="og:title" content="Sakuli End2End Testing and Monitoring | Writing Tests" />
    <meta property="og:description" content="Behavior and performance validation of every application. DOM and native UI Testing features cover every scenario. Send performance data to monitoring systems." />
    <meta property="og:image" content="https://sakuli.io/images/sakuli_hero.png" />
    <meta property="og:site_name" content="Sakuli End-to-End Testing and Monitoring" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Sakuli E2E | Writing Tests" />
    <meta name="twitter:description" content="Behavior and performance validation of basically every application. Test like a real-world user. DOM-based and native UI Testing features cover every scenario. Send performance data to monitoring systems. The Pinnacle of Testing!" />
    <meta name="twitter:image" content="https://sakuli.io/images/sakuli_hero.png" />
    <meta name="twitter:site" content="@sakuli_e2e" />

    
    
    
    
    <link rel="stylesheet" href="/css/bundle.css" integrity="" />
    <link href="/fontawesome/css/all.min.css" rel="stylesheet">
    

    

    
    
    <script lang="text/javascript">
        var ua = window.navigator.userAgent;
        var version = ieVersion(ua);
        if (version && version >= 10 && version <= 11) {
            document.write('<script crossorigin="anonymous" src="https://polyfill.io/v3/polyfill.min.js?features=Object.assign%2CArray.from%2CPromise%2CString.prototype.startsWith"><\/script>');
            document.write('<link rel="stylesheet" href="\/ie.css" integrity="" />')
        }
        function ieVersion(uaString) {
            uaString = uaString || navigator.userAgent;
            var match = /\b(MSIE |Trident.*?rv:|Edge\/)(\d+)/.exec(uaString);
            if (match) return parseInt(match[2])
        }
    </script>
</head>

<body>
    
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TMFSKHB" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    
    <a href="https://www.github.com/sakuli/sakuli" target="_blank" rel="noopener" class="github-corner"
        aria-label="View source on GitHub">
        <svg width="70" height="70" viewBox="0 0 250 250"
            style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg></a>
    <style>
        .github-corner:hover .octo-arm {
            animation: octocat-wave 560ms ease-in-out
        }

        @keyframes octocat-wave {

            0%,
            100% {
                transform: rotate(0)
            }

            20%,
            60% {
                transform: rotate(-25deg)
            }

            40%,
            80% {
                transform: rotate(10deg)
            }
        }

        @media (max-width:500px) {
            .github-corner:hover .octo-arm {
                animation: none
            }

            .github-corner .octo-arm {
                animation: octocat-wave 560ms ease-in-out
            }
        }
    </style>

    <header class="navbar navbar-expand-lg sticky-top navbar-light bg-none" style="height: 100%;">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navBar" aria-controls="navBar"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <nav class="collapse navbar-collapse" id="navBar">
            <a class="navbar-brand flex-grow-1 d-none d-sm-block" href="/">
                <svg width="50px" height="50px" version="1.1" id="el_33VhVOlhh" xmlns="http://www.w3.org/2000/svg"
xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 283 283"
enable-background="new 0 0 283.46 283.46" xml:space="preserve">
<style>
    @-webkit-keyframes kf_el_zLp-eZHf9H_an_08tqQJTbr {
        0% {
            -webkit-transform: translate(141.39999759197235px, 141.6250023841858px) rotate(0deg) translate(-141.39999759197235px, -141.6250023841858px);
            transform: translate(141.39999759197235px, 141.6250023841858px) rotate(0deg) translate(-141.39999759197235px, -141.6250023841858px);
        }

        33.33% {
            -webkit-transform: translate(141.39999759197235px, 141.6250023841858px) rotate(360deg) translate(-141.39999759197235px, -141.6250023841858px);
            transform: translate(141.39999759197235px, 141.6250023841858px) rotate(360deg) translate(-141.39999759197235px, -141.6250023841858px);
        }

        100% {
            -webkit-transform: translate(141.39999759197235px, 141.6250023841858px) rotate(360deg) translate(-141.39999759197235px, -141.6250023841858px);
            transform: translate(141.39999759197235px, 141.6250023841858px) rotate(360deg) translate(-141.39999759197235px, -141.6250023841858px);
        }
    }

    @keyframes kf_el_zLp-eZHf9H_an_08tqQJTbr {
        0% {
            -webkit-transform: translate(141.39999759197235px, 141.6250023841858px) rotate(0deg) translate(-141.39999759197235px, -141.6250023841858px);
            transform: translate(141.39999759197235px, 141.6250023841858px) rotate(0deg) translate(-141.39999759197235px, -141.6250023841858px);
        }

        33.33% {
            -webkit-transform: translate(141.39999759197235px, 141.6250023841858px) rotate(360deg) translate(-141.39999759197235px, -141.6250023841858px);
            transform: translate(141.39999759197235px, 141.6250023841858px) rotate(360deg) translate(-141.39999759197235px, -141.6250023841858px);
        }

        100% {
            -webkit-transform: translate(141.39999759197235px, 141.6250023841858px) rotate(360deg) translate(-141.39999759197235px, -141.6250023841858px);
            transform: translate(141.39999759197235px, 141.6250023841858px) rotate(360deg) translate(-141.39999759197235px, -141.6250023841858px);
        }
    }

    #el_33VhVOlhh * {
        -webkit-animation-duration: 3s;
        animation-duration: 3s;
        -webkit-animation-iteration-count: 1;
        animation-iteration-count: 1;
        -webkit-animation-play-state: running;
        animation-play-state: running;
        -webkit-animation-timing-function: cubic-bezier(0, 0, 1, 1);
        animation-timing-function: cubic-bezier(0, 0, 1, 1);
    }

    #el_zLp-eZHf9H {
        fill: #95C11F;
    }

    #el_33VhVOlhh:hover #el_zLp-eZHf9H {}

    #el_rscYgXSW76 {
        visibility: hidden;
    }

    #el_ELwiMJ6WZY {
        visibility: hidden;
    }

    #el_0KllcPOMi_ {
        visibility: hidden;
    }

    #el_srYemrCGoT {
        visibility: hidden;
    }

    #el_Rf8EvIwiTj {
        visibility: hidden;
    }

    #el_LBd_rRl8Bh {
        visibility: hidden;
    }

    #el_zLp-eZHf9H_an_08tqQJTbr {
        -webkit-animation-fill-mode: backwards;
        animation-fill-mode: backwards;
        -webkit-transform: translate(141.39999759197235px, 141.6250023841858px) rotate(0deg) translate(-141.39999759197235px, -141.6250023841858px);
        transform: translate(141.39999759197235px, 141.6250023841858px) rotate(0deg) translate(-141.39999759197235px, -141.6250023841858px);
        -webkit-animation-timing-function: cubic-bezier(0.42, 0, 0.58, 1);
        animation-timing-function: cubic-bezier(0.42, 0, 0.58, 1);
    }

    #el_33VhVOlhh:hover #el_zLp-eZHf9H_an_08tqQJTbr {
        -webkit-animation-name: kf_el_zLp-eZHf9H_an_08tqQJTbr;
        animation-name: kf_el_zLp-eZHf9H_an_08tqQJTbr;
    }
</style>
<g id="el_zLp-eZHf9H_an_08tqQJTbr" data-animator-group="true" data-animator-type="1">
    <path d="M141.41,1.31C64.04,1.31,1.09,64.25,1.09,141.62s62.95,140.32,140.31,140.32
    c77.37,0,140.31-62.95,140.31-140.32S218.78,1.31,141.41,1.31z M131.87,118.32c5.85,3.75,7.55,11.52,3.8,17.37
    c-2.4,3.75-6.46,5.79-10.6,5.79c-2.32,0-4.67-0.64-6.77-1.99l-39.43-25.27c-6.65-4.26-10.62-11.52-10.62-19.43
    c0-7.9,3.97-15.17,10.63-19.43L118.3,50.1c5.85-3.75,13.63-2.04,17.37,3.8c3.75,5.85,2.05,13.63-3.8,17.37L95.17,94.8L131.87,118.32
    z M204.75,203.85l-39.43,25.27c-2.1,1.35-4.45,1.99-6.77,1.99c-4.14,0-8.2-2.04-10.6-5.79c-3.75-5.85-2.05-13.63,3.8-17.37
    l36.7-23.52l-36.7-23.52c-5.85-3.75-7.55-11.52-3.8-17.37c3.74-5.85,11.53-7.55,17.37-3.8l39.43,25.27
    c6.65,4.26,10.62,11.53,10.62,19.43C215.37,192.32,211.4,199.59,204.75,203.85z"
        id="el_zLp-eZHf9H"></path>
</g>
</svg>

            </a>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/docs/getting-started">Docs</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/features">Features</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/enterprise">Enterprise</a>
                </li>
            </ul>
        </nav>
    </header>
    <main>


<div id="docs-page">
    <aside id="main-nav">
        <a class="navbutton right" id="hide-menu-button">
            <i class="fas fa-times"></i>
        </a>
        <nav>
            
            
            <section class="section-navigation">
    <div class="search-field" style="display: none">
        <input type="text" class="search-field--input" />
        <i class="fas fa-search search-field--icon"></i>
    </div>
    
    
    
    <ul>
        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/getting-started/" class="">
            Getting started
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/100_writing-tests/" class=" active ">
            Writing Tests
    </a>
    
    
    
    <ul>
        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/100_writing-tests/000_anatomy-project/" class="">
            Anatomy of a Project
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/100_writing-tests/faq-tests/" class="">
            Frequently Asked Questions
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/100_writing-tests/100_native-testing/110_interacting-with-env/" class="">
            Interacting with the environment
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/100_writing-tests/100_native-testing/100_screenshot-based/" class="">
            Screenshot based Testing
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/100_writing-tests/000_web-testing/" class="">
            Web tests
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/enterprise/" class="">
            Enterprise Features
    </a>
    
    
    
    <ul>
        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/enterprise/icinga2-forwarder/" class="">
            Icinga2 Forwarder
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/enterprise/check_mk-forwarder/" class="">
            Check_MK Forwarder
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/enterprise/omd-forwarder/" class="">
            OMD / Gearman Forwarder
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/enterprise/test-container/" class="">
            E2E Test Container
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/enterprise/s2i-image/" class="">
            S2I Image
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
    </ul>

</li>

        
            
<li class="no-chevron">
    <i class="chevron">&nbsp;</i>
    <a href="/docs/cli-commands/" class="">
            CLI Commands
    </a>
    
    
    
    <ul>
        
    </ul>

</li>

        
    </ul>

</section>



            <section class="section-navigation">
                <strong>API Docs</strong>
                <ul>
                    <li>
                        <a href="/apidoc/sakuli-legacy" target="_blank" rel="noopener">@sakuli/legacy</a>
                    </li>
                    <li>

                        <a href="/apidoc/sakuli-core" target="_blank" rel="noopener">
                            @sakuli/core
                        </a>
                    </li>
                    <li>
                        <a href="/apidoc/sakuli-cli" target="_blank" rel="noopener">
                            @sakuli/cli
                        </a>
                    </li>
                    <li>
                        <a href="/apidoc/sakuli-commons" target="_blank" rel="noopener">
                            @sakuli/commons
                        </a>
                    </li>
                    <li>
                        <a href="/apidoc/sakuli-rollup-hooks" target="_blank" rel="noopener">
                            @sakuli/rollup-hooks
                        </a>
                    </li>
                </ul>
            </section>
        </nav>
    </aside>
    <div class="page">
        <article class="shrink-content">
            <h1>Writing Tests</h1>
            

<p>With Sakuli v2+ we changed a lot under the hood and completely replaced the technology-stack. This resulted in a more flexible and future-ready architecture while preserving a maximum of backward compatibility.</p>

<h2 id="major-changes-to-sakuli-v1-migration">Major Changes to Sakuli v1 (Migration)</h2>

<p>Nearly all functions and classes from Sakuli v1 are available in Sakuli v2+. They are provided by the <a href="/apidoc/sakuli-legacy/interfaces/legacyapi"><strong>@sakuli/legacy</strong></a> package.</p>

<h3 id="async-await">Async / Await</h3>

<p>You might have wondered where the <code>await</code> keyword came from when you saw the Sakuli v2+ code. This resulted from the decision to use Node.js as the new runtime for Sakuli. The following section will describe the background of the async/await syntax and its use in Sakuli. If you are already familiar with JavaScript, you can skip this section since it contains a lot of basic information.</p>

<h4 id="why-we-need-it">Why we need it</h4>

<p><strong><em>TL; DR;</em></strong></p>

<ul>
<li>Due to the runtime and core libraries, asynchronous operations are required (and cannot be turned into synchronous operations)</li>
<li>Async/Await is the most idiomatic way to handle asynchronous code in JavaScript</li>
</ul>

<p>If you ever worked with Sakuli and followed our <a href="/docs/getting-started">&ldquo;<strong>Getting started</strong>&ldquo;</a> guide, you might have noticed one of the most obvious paradigmatic changes regarding the test syntax: The wrapping <code>(async () =&gt; /*...*/)().then(done)</code> and the extensive use of <code>await</code>. This is due to the new runtime <a href="https://nodejs.org"><strong>Node.js</strong></a> and its asynchronous nature. Node.js executes scripts in a single-thread and therefore makes heavy use of asynchronous operations avoiding to block the execution within the thread. The underlying JavaScript engine is <a href="https://v8.dev/"><strong>V8</strong></a> (which also powers the JavaScript execution in <a href="https://www.chromium.org/Home"><strong>Chromium Browsers</strong></a>). To make this asynchronous behavior possible, V8 uses a so called &ldquo;Event-Loop&rdquo; with a &ldquo;Call-Stack&rdquo; containing all deferred operations (like: reading a file, making a web-request, doing heavy computation and so on). <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ"><strong>This talk</strong></a> explains this behavior in a short and entertaining way. A good illustration for the event loop is a (fast-food) restaurant, where you place an order at the counter and get a receiver that informs you when your food is ready. Now you can do something else in the meantime while not blocking other processes or being blocked by them until you get your food and can do further operations (e.g. eat your meal).</p>

<p>But how does all this effect Sakuli? Sakuli v1 was running within a Java Virtual Machine and the test scripts were executed within the <a href="https://developer.mozilla.org/de/docs/Rhino"><strong>Rhino-Engine</strong></a> (JavaScript Runtime for the JVM) - its fundamental treatment of asynchronous operations completely differs compared to Node. Simply said, everything in Java is blocking until you make it non-blocking, while in Node (many) operations are non-blocking by default. In Java for example it is a rather common custom to run while-loops until the asynchronous operation sets its condition to false. This repl displays the basic idea: <a href="https://repl.it/@tnobody/non-blocking-vs-blockingjava"><strong>Java version</strong></a>.</p>

<p>&ldquo;Unfortunately&rdquo;, it is not (easily) possible to turn non-blocking operations into blocking operations in Node (<a href="https://repl.it/@tnobody/non-blocking-vs-blockingjs"><strong>have a look at this repl</strong></a>) and Sakuli&rsquo;s core technologies (Selenium-WebDriver and nut.js) make heavy use of asynchronous operations. There are tools like <a href="https://www.npmjs.com/package/fibers"><strong>fibers</strong></a> that can help you, but they rely on native (OS-dependent) libraries. Therefore, we have decided to avoid another OS specific library in Sakuli.</p>

<p>Last but not least: Using and writing asynchronous code is the most idiomatic way to write JavaScript nowadays. Using async/await is a kind of syntactic sugar, which lets us write asynchronous code like it would be synchronous just by using the <code>await</code> keyword. A short look back in the old days makes it clear how JavaScript landed there:</p>

<p>Back then, the most common way to handle asynchronous code was via callbacks. They were passed on to the asynchronous operation where they were executed as soon as the initial operation was finished. This approach was useful and acceptable for the usual JavaScript use-case during those days: Handling events in the DOM. But when Node was released and many browser applications became more and more complex, the developers ended up with a so called <a href="http://callbackhell.com/">&ldquo;<strong>callback hell</strong>&ldquo;</a>. To exit this callback hell, ES6 introduced the <a href="https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Promise"><strong><code>Promise</code> class</strong></a>. The advantage of a Promise is its ability to chain with other Promises, making it way more elegant to write subsequent, dependent asynchronous operations. A good read on this topic can be found on chapter VIII of <a href="https://exploringjs.com/impatient-js/toc.html"><strong>JavaScript for impatient programmers</strong></a></p>

<h4 id="the-async-wrapper">The async wrapper</h4>

<p>You might have noticed that if a testcase in Sakuli v2 is wrapped within <code>(async () =&gt; /*...*/)().then(done)</code> this construct it is called <em>Immediately Invoked Function Expression</em> (IIFE). Basically, it is the definition of a function that is immediately invoked. This pattern is widely used in JavaScript to preserve scopes and namespaces, since every symbol, which is defined at the top level of a script, becomes part of the global namespace and may potentially collide with other scripts. In the era of <a href="https://medium.com/fusebox/beginner-web-developers-use-a-bundler-31ab0c91d2f5"><strong>web bundler</strong></a> and <a href="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/"><strong>ES-modules</strong></a> this use-case became more and more irrelevant. IIFE on the other hand still remains important after the introduction of async/await in JavaScript. One caveat of this syntax is, that the <code>await</code> keyword is only available within an asynchronous function - because the engine will wrap the whole body of this function within a Promise. That means, that in order to be able to make use of the <code>await</code> keyword, your code has to be executed within an asynchronous function. On the top level IIFE, we declare the actual function as <code>async</code> and can make use of <code>await</code>. Since the result of this function is automatically turned into a Promise, we can invoke <code>then</code> and pass the <code>done</code> function to it. <code>done</code> is a Sakuli specific function, which indicates to Sakuli that the testcase script is finished. There is currently a discussion on the <a href="https://github.com/tc39/proposal-top-level-await"><strong>JavaScript proposal in stage 3</strong></a>, which would introduce a <em>top level await</em> in JavaScript.</p>

<p>If you want to avoid this construct completely, you can use the <code>then</code> function of a Promise. The example code of the <a href="/docs/getting-started">&ldquo;<strong>Getting started</strong>&ldquo;</a> guide would look like this then:</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">testCase</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TestCase</span>();

<span style="color:#a6e22e">_navigateTo</span>(<span style="color:#e6db74">&#34;https://sakuli.io&#34;</span>)
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">_</span> =&gt; <span style="color:#a6e22e">testCase</span>.<span style="color:#a6e22e">endOfStep</span>(<span style="color:#e6db74">&#34;Open Landing Page&#34;</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>))
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">_</span> =&gt; <span style="color:#a6e22e">_click</span>(<span style="color:#a6e22e">_link</span>(<span style="color:#e6db74">&#34;Getting started&#34;</span>)))
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">_</span> =&gt; <span style="color:#a6e22e">_highlight</span>(<span style="color:#a6e22e">_code</span>(<span style="color:#e6db74">&#34;npm init&#34;</span>)))
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">_</span> =&gt; <span style="color:#a6e22e">testCase</span>.<span style="color:#a6e22e">endOfStep</span>(<span style="color:#e6db74">&#34;Find npm init code sample&#34;</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">e</span> =&gt; <span style="color:#a6e22e">testCase</span>.<span style="color:#a6e22e">handleException</span>(<span style="color:#a6e22e">e</span>))
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">_</span> =&gt; <span style="color:#a6e22e">testCase</span>.<span style="color:#a6e22e">saveResult</span>())
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">done</span>);
</code></pre></td></tr></table>
</div>
</div>

<p>This is also a totally valid format that can be used within Sakuli. However, this approach has two downsides:</p>

<ul>
<li>If you are less familiar with JavaScript, it could become harder to read and understand</li>
<li>The examples mentioned in the Sakuli documentation will mostly use the await/async syntax</li>
</ul>

<p>Due to those reasons, we would advise you not to use the <code>.then(...)</code> syntax, unless you are completely sure about what you are doing.</p>

<h4 id="async-functions">Async Functions</h4>

<p>Most functions which implement the <a href="https://sahipro.com/docs/sahi-apis/index.html"><strong>Sahi DSL</strong></a> - recognizable by a prefixed underscore - return a Promise. That means, that you should put an <code>await</code> in front of it. Exceptions from this pattern are <a href="/apidoc/sakuli-legacy/interfaces/accessorapi.html"><strong>Accessor functions</strong></a>, which create query objects to access elements in the DOM. You can check if the function returns a Promise in the <a href="apidoc/sakuli-legacy/interfaces/sahiapi.html"><strong>API docs of SahiAPI</strong></a>. If you are not sure that you need an <code>await</code>, you can put it anyway since the function will be executed as expected. Considering that this is not a good practice, we are working on tools which will help you identify async functions like <a href="https://github.com/sakuli/sakuli/tree/feature/ts-support"><strong>Typescript support</strong></a>.</p>

<h4 id="thenable-classes">Thenable Classes</h4>

<p>Sakuli has some classes - especially those for native interactions - which implement the <a href="https://de.wikipedia.org/wiki/Fluent_Interface"><strong>Fluent Interface pattern</strong></a>, where you can chain method invocations on the same object. Unfortunately, this does not really play nice with asynchronous operations. Methods of a fluent API always return the object itself or at least an instance of the same class. But an asynchronous (and awaitable) method rather needs to return a Promise. To still accomplish the goal of backward compatibility, all classes implementing a fluent interface and including asynchronous methods are wrapped in a <code>Thenable&lt;ClassName&gt;</code> form of itself. This concept is highly inspired by Selenium-WebDrivers <a href="https://seleniumhq.github.io/selenium/docs/api/javascript/module/selenium-webdriver/index_exports_ThenableWebDriver.html"><strong>ThenableWebDriver</strong></a>. From an end-user perspective, you can use the fluent interface almost like before, except of a little <code>await</code> at the beginning:</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// With Thenable classes; Assuming we are in the context of an async function
</span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">screen</span>.<span style="color:#a6e22e">find</span>(<span style="color:#e6db74">&#39;button.png&#39;</span>).<span style="color:#a6e22e">click</span>();

<span style="color:#75715e">// Without Thenable class
</span><span style="color:#75715e"></span><span style="color:#a6e22e">screen</span>.<span style="color:#a6e22e">find</span>(<span style="color:#e6db74">&#39;button.png&#39;</span>)
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">screen</span> =&gt; <span style="color:#a6e22e">screen</span>.<span style="color:#a6e22e">click</span>());
</code></pre></td></tr></table>
</div>
</div>

<p><strong>Thenable Classes are</strong>:</p>

<ul>
<li><a href="/apidoc/sakuli-legacy/interfaces/thenableapplication.html">Application</a></li>
<li><a href="/apidoc/sakuli-legacy/interfaces/thenableenvironment.html">Environment</a></li>
<li><a href="/apidoc/sakuli-legacy/interfaces/thenableregion.html">Region</a></li>
</ul>

<p>The technical trick behind this is, that there are two implementations: The actual class with the async functions and a <code>thenable</code> class, which implements the PromiseLike interface. The PromiseLike interface basically forces a <code>then</code> function to be implemented and is therefore &ldquo;awaitable&rdquo;. The wrapper class also holds a Promise with the instance to the actual class. When a method of the thenable class is invoked, it delegates the call to the same method of the actual class and returns itself with the Promise given back by the actual method. Since the thenable class itself is a Promise, it will resolve to an instance of the actual class.</p>

<h3 id="include-and-includedynamic">_include and _includeDynamic</h3>

<p>If you ever wrote larger or different testcases on the same system, you might have come up with a modularization of commonly used functions. For example, the login to a system is always the same in all testcases, so you put it into a separate file.</p>

<p>Sakuli v1 includes functions to load these files into your actual testcase: <code>_include</code> or <code>_includeDynamic</code>. The code usually looks like this:</p>

<p><code>&lt;TESTSUITE&gt;/common/login.js</code>:
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">login</span>(<span style="color:#a6e22e">$user</span>, <span style="color:#a6e22e">$password</span>) {
    <span style="color:#75715e">//... login logic
</span><span style="color:#75715e"></span>}
</code></pre></td></tr></table>
</div>
</div></p>

<p><code>&lt;TESTSUITE&gt;/testcase/case.js</code>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">_include</span>(<span style="color:#e6db74">&#39;../commons/login.js&#39;</span>);

<span style="color:#66d9ef">try</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">testcase</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TestCase</span>(<span style="color:#e6db74">&#39;&#39;</span>);

    <span style="color:#a6e22e">login</span>(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>);

    <span style="color:#75715e">// actual test code
</span><span style="color:#75715e"></span>} <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">e</span>) {
    <span style="color:#a6e22e">testcase</span>.<span style="color:#a6e22e">handleException</span>(<span style="color:#a6e22e">e</span>);
} <span style="color:#66d9ef">finally</span> {
    <span style="color:#a6e22e">testcase</span>.<span style="color:#a6e22e">saveResults</span>();
}
</code></pre></td></tr></table>
</div>
</div></p>

<p>Two interesting aspects can be observed here:</p>

<ul>
<li>Functions defined in the included script were added to the global namespace</li>
<li>It is not an idiomatic way to require dependent code in JavaScript (nowadays)</li>
</ul>

<p>Sakuli now introduces support for <a href="https://2ality.com/2014/09/es6-modules-final.html"><strong>ES-module syntax</strong></a>. To adapt the example above, it has to be rewritten as follows:</p>

<p><i class="fas fa-file"></i>  <code>&lt;TESTSUITE&gt;/common/login.js</code>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">login</span>(<span style="color:#a6e22e">$user</span>, <span style="color:#a6e22e">$password</span>) {
</span>    <span style="color:#75715e">//... login logic
</span><span style="color:#75715e"></span>}
</code></pre></td></tr></table>
</div>
</div></p>

<p><i class="fas fa-file"></i> <code>&lt;TESTSUITE&gt;/testcase/case.js</code>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">import</span> {<span style="color:#a6e22e">login</span>} <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./../commons/login&#39;</span>;
</span>
<span style="color:#66d9ef">try</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">testcase</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TestCase</span>(<span style="color:#e6db74">&#39;&#39;</span>);

    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">login</span>(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>);

    <span style="color:#75715e">// actual test code
</span><span style="color:#75715e"></span>} <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">e</span>) {
    <span style="color:#a6e22e">testcase</span>.<span style="color:#a6e22e">handleException</span>(<span style="color:#a6e22e">e</span>);
} <span style="color:#66d9ef">finally</span> {
    <span style="color:#a6e22e">testcase</span>.<span style="color:#a6e22e">saveResults</span>();
}
</code></pre></td></tr></table>
</div>
</div></p>

<p>Beside the added async/await keywords, we can see that the first line of each script changed. In the first script, all functions (or classes, enums, constants, etc) have to be explicitly exported by the script (&ldquo;module&rdquo; would be a more accurate term) if they should be used in other scripts. For the actual testcase script the <code>_include</code> function will be removed and replaced by an <code>import</code>. The <code>import</code> ensures that we only import symbols that are required in the current script and its <em>global</em> namespace. Each function required in the testcase script has to be imported explicitly. An alternative syntax is to import everything within its own namespace:</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">loginUtils</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./../commons/login&#39;</span>;

<span style="color:#75715e">// omitting boilerplate code
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">await</span> <span style="color:#a6e22e">loginUtils</span>.<span style="color:#a6e22e">login</span>(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>);
</code></pre></td></tr></table>
</div>
</div>

        </article>
        <aside id="secondary-nav">
            <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#major-changes-to-sakuli-v1-migration">Major Changes to Sakuli v1 (Migration)</a>
<ul>
<li><a href="#async-await">Async / Await</a>
<ul>
<li><a href="#why-we-need-it">Why we need it</a></li>
<li><a href="#the-async-wrapper">The async wrapper</a></li>
<li><a href="#async-functions">Async Functions</a></li>
<li><a href="#thenable-classes">Thenable Classes</a></li>
</ul></li>
<li><a href="#include-and-includedynamic">_include and _includeDynamic</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
        </aside>
    </div>
    <a class="navbutton left" href="#docs-page">
        <i class="fas fa-chevron-up"></i>
    </a>
    <a class="navbutton right" id="show-menu-button">
        <i class="fas fa-bars"></i>
    </a>
</div>



</main>
<footer>
    <nav>
        <ul>
            <li> © 2019 ConSol Consulting & Solutions Software GmbH</li>
            <li><a href="/legalnotice">Legal Notice</a></li>
            <li><a id="data-privacy-link" href="https://www.consol.com/data-privacy/" target="_blank" rel="noopener">Data Privacy</a></li>
            <li><a id="contact-link" href="https://www.consol.com/request-sakuli-enterprise" target="_blank" data-contactform="Contact our Team">Contact</a></li>
        </ul>
    </nav>
</footer>
<div id="modal"></div>






<script src="/js/bundle.min.js"></script>
</body>
</html>

